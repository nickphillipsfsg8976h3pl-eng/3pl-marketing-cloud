
<!--
/**************************
GET PREFRENCE CENTRE v2
**************************/
-->


%%[/*
==============================================================================

Welcome to the prefernece centre! 

This page is the main ui that a customer would see after clicking the 'preference centre' link at the bottom of their emails.

As of December 2021, we collect 3 types of informatioon on a customer:

- personal (email, mobile number, birthdate), 
- subscriptions/marketing interests (product updates, newsletter, promotions), 
- and product interests (mathletics, mathseeds, reading eggs). 

On submit this information is updated in 3 places:
(Please see the accompanying 'submit' script)

- profile/preference attribtutes in marketing cloud,
- publication lists in marketing cloud
- & in the Lead Object in the SF CRM


TODO:
- bug fix: profile/preference attributes are not updated if status is unsubscribed (normal internal MC feature)
- turn on mobile number
- click on card not checkbox
- add semantic html and aria attributes
- add favicon
- add a "snooze" dropdown instead of unsubscribe
- add "How often would you like to hear from us" dropdown

LOG
- 10/01/22: added GA gtag.js in the <head>

==============================================================================
*/]%%





<!-- ================== SERVER-SIDE ================== -->


<script runat="server">
  Platform.Load("Core", "1")
  try {



    /***********************************************
    -- GET SUBSCRIBER
    ************************************************/  

    var _subscriberKey = _SubscriberKey? _SubscriberKey : "00Q9D0000032GE7UAM";

    var subscriber = Subscriber.Retrieve({Property:"SubscriberKey",SimpleOperator:"equals",Value: _subscriberKey});
    var subscriberKey = subscriber[0].SubscriberKey;
    var subscriberID = subscriber[0].ID;
    var emailAddress = subscriber[0].EmailAddress;
    var status = subscriber[0].Status;

    Variable.SetValue("@SUBSCRIBER_KEY", subscriberKey);
    Variable.SetValue('@EMAIL_ADDRESS', emailAddress);
    Variable.SetValue('@STATUS', status == "Unsubscribed"? false: true);



    //debug    
    //  for(var key in subscriber[0]) {
    //     Write(key+' : '+ subscriber[0][key]+'<br>');
    //  }//for
    //  Write('<br>')


    /***********************************************
    -- GET PROFILE/PREFERNCES ATTRIBUTES
    ************************************************/


    var attributes = Subscriber.Init(subscriberKey).Attributes.Retrieve();

    var profile={};

    for(var i=0; i<attributes.length; i++) {

      if (attributes[i].Name==='GUID') { profile.GUID = attributes[i].Value };
      if (attributes[i].Name==='Birthdate') { profile.birthdate = attributes[i].Value };
      if (attributes[i].Name==='Mobile Number') { profile.mobileNumber = attributes[i].Value };

      if (attributes[i].Name==='3PL_Mathletics') { profile.mathletics = attributes[i].Value };
      if (attributes[i].Name==='3PL_Reading Eggs') { profile.readingEggs = attributes[i].Value };
      if (attributes[i].Name==='3PL_Mathseeds') { profile.mathseeds = attributes[i].Value };
      if (attributes[i].Name==='3PL_Newsletter') { profile.newsletter = attributes[i].Value };
      if (attributes[i].Name==='3PL_Product Information') { profile.productInformation = attributes[i].Value };
      if (attributes[i].Name==='3PL_Promotions') { profile.promotions = attributes[i].Value };

    }//for

    Variable.SetValue('@MOBILE_NUMBER', profile.mobileNumber);
    Variable.SetValue('@BIRTHDATE', profile.birthdate);

    Variable.SetValue('@MATHLETICS', profile.mathletics);
    Variable.SetValue('@READING_EGGS', profile.readingEggs);
    Variable.SetValue('@MATHSEEDS', profile.mathseeds);
    Variable.SetValue('@NEWSLETTER', profile.newsletter);
    Variable.SetValue('@PRODUCT_INFORMATION', profile.productInformation);
    Variable.SetValue('@PROMOTIONS', profile.promotions);



    //debug

    //  for(var i=0; i<attributes.length; i++) {
    //    Write(attributes[i].Name+' : '+attributes[i].Value+'<br>');
    //  }//for

    //  Write('<br>');

    //  for(var key in profile) {
    //     Write('profile.'+key+' : '+ profile[key]+'<br>');
    //  }//for

    //  Write('<br>');


    /*****************************************************************
    -- GET ALL RELATED RECORD SUBSCRIBER KEYS (BASED ON EMAIL ADDRESS)
    ******************************************************************/


    var relatedSubscribers = DataExtension.Init("ent._Subscribers").Rows.Lookup(["EmailAddress"], [emailAddress]);

    var subscriberKeys = [];
    for (var i=0; i<relatedSubscribers.length; i++) {
      subscriberKeys.push(relatedSubscribers[i].SubscriberKey);
    }//for

    Variable.SetValue('@SUBSCRIBER_KEYS', subscriberKeys.toString())


    //debug
    //Write('@SUBSCRIBER_KEYS: '+ Stringify(subscriberKeys) +'<br><br>');



    /*****************************************************************
    -- GET ALL RELATED RECORD SUBSCRIBER KEYS (BASED ON GUID)
    ******************************************************************/


    //  var entAttributeDE = DataExtension.Init("ent._EnterpriseAttribute")
    //  var GUID = entAttributeDE.Rows.Lookup(["_SubscriberID"], [subscriberID])[0].GUID;
    //  var relatedAttributes = entAttributeDE.Rows.Lookup(["GUID"], [GUID]);

    //  var subscriberKeys = [];

    //     for (var i=0; i<relatedAttributes.length; i++) {
    //       subscriberKeys.push(entSubscribersDE.Rows.Lookup(["SubscriberID"], [relatedAttributes[i]._SubscriberID])[0].SubscriberKey)
    //     }//for

    //     Variable.SetValue('@SUBSCRIBER_KEYS', subscriberKeys.toString())


    //debug
    //  Write('keys: '+ relatedAttributes +'<br><br>');


    /***********************************************
    -- GENERAL PARAMETERS
    ************************************************/


    //Variable.SetValue("@JOB_ID", jobID);
    //Variable.SetValue("@LIST_ID", listID);
    //Variable.SetValue("@BATCH_ID", _JobSubscriberBatchID);



    /***********************************************
    -- HEADERS
    ************************************************/


    //no cache
    Platform.Response.SetResponseHeader("Cache-Control","no-store, must-revalidate");
    Platform.Response.SetResponseHeader("Pragma","no-cache");
    Platform.Response.SetResponseHeader("Expires","0");

    //security
    Platform.Response.SetResponseHeader("Strict-Transport-Security","max-age=200");
    Platform.Response.SetResponseHeader("X-XSS-Protection","1; mode=block");
    Platform.Response.SetResponseHeader("X-Frame-Options","Deny");
    Platform.Response.SetResponseHeader("X-Content-Type-Options","nosniff");
    Platform.Response.SetResponseHeader("Referrer-Policy","strict-origin-when-cross-origin");
    //Platform.Response.SetResponseHeader("Content-Security-Policy","default-src 'self'");



  } catch(e) {
    //Redirect("https://cloud.my.3plearning.com/error_preferences",false);
    Write(Stringify(e));
  }
</script>






<!-- ====================================================== HEAD ====================================================== -->






<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <!-- Documentation: https://developers.google.com/analytics/devguides/collection/gtagjs/ -->
    %%=Concat('<', 'script async src="https://www.googletagmanager.com/gtag/js?id=G-S1F8V332SB"></script>')=%%
    %%=Concat('<', 'script>')=%%
    window.dataLayer = window.dataLayer || [];
    function gtag(){window.dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S1F8V332SB');
    %%=Concat('</', 'script>')=%%


    <!-- META -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>3PLearning - Email Preferences</title>

    <!-- Materialize: Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Materialize: Compiled and minified JavaScript -->
    %%=Concat('<', 'script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>')=%%


    <!-- STYLES -->
    <style>

      /*Brand Colors*/

      :root {
        --custom-green: #015f4e;
        --custom-dark-green: #00473b;
        --custom-white: #ffffff;
        --custom-grey-switch: rgb(0,0,0,0.38);
        --custom-grey-unsubscribe-panel: rgb(231,231,231);
      }

      /*Custom Elements*/

      .custom-background {
        background: url(https://image.my.3plearning.com/lib/fe9413737461017874/m/3/144947cc-210d-4c26-b9f7-7dc688d4ccf4.png);
        background-size: cover;
        background-repeat: no-repeat;
        background-position: 70% 0;
      }
      @media screen and (max-width: 800px) {
      }
      .custom-nav {
        background-color: white;
        box-shadow: 0px 1px 4px 0px lightgrey;
        padding: 25px 0px;
      }
      @media screen and (max-width: 480px) {
        .custom-mobile-center {
          display: block;
          margin: auto;
        }
      }
      .custom-footer {
        background-color: var(--custom-dark-green);
        color: white;
        padding-top: 60px;
        padding-bottom: 60px;
      }
      .custom-intro-text {
        font-size: 1.2rem
      }

      .custom-unsubscribe-panel {
        background-color: var(--custom-grey-unsubscribe-panel);
        padding: 24px;
      }

      .custom-min-height {
        min-height: 170px;
      }

      .custom-panel-content-position {
        display: flex;
        flex-flow: row nowrap;
      }

      .custom-submit-button {
        display: inline-block;
        background-color: var(--custom-green);
        border: 2px solid var(--custom-green);
        border-radius: 2em;
        padding: 1.5rem;
        font-size: 1.5rem;
        color: #fff;
        text-align: center;
        line-height: 1;
        cursor: pointer;
      }

      .custom-submit-button:hover {
        background-color: var(--custom-dark-green);
        border: 2px solid var(--custom-dark-green);

      }

      .custom-spacing-20px {
        padding-top: 20px;
      }

      .custom-spacing-40px {
        padding-top: 40px;
      }

      .custom-spacing-60px {
        padding-top: 60px;
      }

      .custom-spacing-80px {
        padding-top: 80px;
      }

      .custom-spacing-100px {
        padding-top: 100px;
      }

      .custom-remove-margin {
        margin: 0 !important;
      }
      .custom-loading-backdrop {
        background-color: rgb(0,0,0,0.3);
        position: fixed;
        top: 0; 
        bottom: 0;
        left: 0;
        right: 0;
      }
      .custom-loading-spinner-position {
        position: fixed;
        top: calc(50% - 70px);
        left: calc(50% - 35px);
      }


      /*Materialize CSS Overrides*/

      input.valid:not([type]), input.valid:not([type]):focus, input.valid[type=text]:not(.browser-default), input.valid[type=text]:not(.browser-default):focus, 
      input.valid[type=password]:not(.browser-default), input.valid[type=password]:not(.browser-default):focus, input.valid[type=email]:not(.browser-default), 
      input.valid[type=email]:not(.browser-default):focus, input.valid[type=url]:not(.browser-default), input.valid[type=url]:not(.browser-default):focus, 
      input.valid[type=time]:not(.browser-default), input.valid[type=time]:not(.browser-default):focus, input.valid[type=date]:not(.browser-default), 
      input.valid[type=date]:not(.browser-default):focus, input.valid[type=datetime]:not(.browser-default), input.valid[type=datetime]:not(.browser-default):focus, 
      input.valid[type=datetime-local]:not(.browser-default), input.valid[type=datetime-local]:not(.browser-default):focus, input.valid[type=tel]:not(.browser-default), 
      input.valid[type=tel]:not(.browser-default):focus, input.valid[type=number]:not(.browser-default), input.valid[type=number]:not(.browser-default):focus, 
      input.valid[type=search]:not(.browser-default), input.valid[type=search]:not(.browser-default):focus, textarea.materialize-textarea.valid, 
      textarea.materialize-textarea.valid:focus, .select-wrapper.valid>input.select-dropdown {
        border-bottom: 1px solid var(--custom-dark-green);
        -webkit-box-shadow: 0 1px 0 0 var(--custom-dark-green);
        box-shadow: 0 1px 0 0 var(--custom-dark-green);
      }
      input:not([type]):focus:not([readonly]), input[type=text]:not(.browser-default):focus:not([readonly]), 
      input[type=password]:not(.browser-default):focus:not([readonly]), input[type=email]:not(.browser-default):focus:not([readonly]), 
      input[type=url]:not(.browser-default):focus:not([readonly]), input[type=time]:not(.browser-default):focus:not([readonly]), 
      input[type=date]:not(.browser-default):focus:not([readonly]), input[type=datetime]:not(.browser-default):focus:not([readonly]), 
      input[type=datetime-local]:not(.browser-default):focus:not([readonly]), input[type=tel]:not(.browser-default):focus:not([readonly]), 
      input[type=number]:not(.browser-default):focus:not([readonly]), input[type=search]:not(.browser-default):focus:not([readonly]), 
      textarea.materialize-textarea:focus:not([readonly]) {
        border-bottom: 1px solid var(--custom-dark-green);
        -webkit-box-shadow: 0 1px 0 0 var(--custom-dark-green);
        box-shadow: 0 1px 0 0 var(--custom-dark-green);
      }
      .input-field .prefix.active {
        color: var(--custom-dark-green);
      }
      .switch label input[type=checkbox]:checked+.lever {
        background-color: var(--custom-grey-switch);
      }
      .switch label input[type=checkbox]:checked+.lever:after {
        background-color: var(--custom-green);
      }
      .datepicker-date-display {
        -webkit-box-flex: 1;
        -webkit-flex: 1 auto;
        -ms-flex: 1 auto;
        flex: 1 auto;
        background-color: var(--custom-green);
        color: #fff;
        padding: 20px 22px;
        font-weight: 500;
      }
      .datepicker-table td.is-selected {
        background-color: var(--custom-green);
        color: #fff;
      }
      .datepicker-cancel, .datepicker-done {
        color: var(--custom-green);
        padding: 0 1rem;
      }

    </style>
  </head>





  <!-- ====================================================== BODY ====================================================== -->





  <body class="custom-background">




    <!-- LOADING INDICATOR -->
    <div id="dom-hidden-loading-indicator">
      <div class="custom-loading-backdrop">
        <div class=custom-loading-spinner-position>
          <div class="preloader-wrapper big active">
            <div class="spinner-layer spinner-green-only">
              <div class="circle-clipper left">
                <div class="circle"></div>
              </div><div class="gap-patch">
              <div class="circle"></div>
              </div><div class="circle-clipper right">
              <div class="circle"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>



    <!-- NAV/LOGO -->
    <div class="custom-nav">
      <div class="container">
        <a href="https://3plearning.com">
          <img class="custom-mobile-center"
               src="https://image.my.3plearning.com/lib/fe3211717d640479701476/m/1/4efa20c6-8ad4-448b-a37c-d1b457fe1210.gif" />
        </a>
      </div>
    </div>



    <!-- FORM -->
    <form id="dom-preferences-form" 
          method="POST"
          action="/submit-preferences-v2-13-12-2021" >



      <!-- HIDDEN -->
      <input type="hidden" name="job_id" value="%%=v(@JOB_ID)=%%">
      <input type="hidden" name="list_id" value="%%=v(@LIST_ID)=%%">
      <input type="hidden" name="batch_id" value="%%=v(@BATCH_ID)=%%">

      <input type="hidden" name="subscriber_key" value="%%=v(@SUBSCRIBER_KEY)=%%" />
      <input type="hidden" name="subscriber_keys" value="%%=v(@SUBSCRIBER_KEYS)=%%">
      <input type="hidden" name="email_address" value="%%=v(@EMAIL_ADDRESS)=%%">

      <input type="hidden" name="previous_mobile_number" value="%%=v(@MOBILE_NUMBER)=%%">
      <input type="hidden" name="previous_birthdate" value="%%=v(@BIRTHDATE)=%%">

      <input type="hidden" name="previous_mathletics" value="%%=v(@MATHLETICS)=%%">
      <input type="hidden" name="previous_mathseeds" value="%%=v(@MATHSEEDS)=%%">
      <input type="hidden" name="previous_reading_eggs" value="%%=v(@READING_EGG)=%%">
      <input type="hidden" name="previous_product_information" value="%%=v(@PRODUCT_INFORMATION)=%%">
      <input type="hidden" name="previous_newsletter" value="%%=v(@NEWSLETTER)=%%">
      <input type="hidden" name="previous_promotions" value="%%=v(@PROMOTIONS)=%%">

      <input type="hidden" name="previous_status" value="%%=IIF(@STATUS != 'unsubscribed', 'true', '')=%%">





      <!-- CONTENT WRAPPER -->
      <div class="container">



        <div class="custom-spacing-40px"></div>



        <!-- TITLE -->
        <div class="row">
          <div class="col s12">
            <h3>Update your preferences</h3>
          </div>
        </div>




        <div class="custom-spacing-40px"></div>




        <!-- EMAIL ADDRESS -->
        <div class="row">
          <div class="input-field col s12">
            <i class="material-icons prefix">email</i>
            <input disabled value="%%=v(@EMAIL_ADDRESS)=%%" id="disabled" type="text" class="validate">
            <label for="disabled">Email</label>
          </div>
        </div>




        <!-- MOBILE NUMBER 

<div class="row">
<div class="input-field col s12">
<i class="material-icons prefix">smartphone</i>
<input type="tel" id="next_mobile_number" name="next_mobile_number" placeholder="Can we message you?">
<label for="icon_telephone">Mobile</label>
</div>
</div>

-->



        <!-- BIRTHDATE -->
        <div class="row">
          <div class="input-field col s12">
            <i class="material-icons prefix">card_giftcard</i>
            <input type="text" id="next_birthdate" name="next_birthdate" placeholder="When is your birthday?" class="datepicker">
            <label for="email">Birthdate</label>
          </div>
        </div>


        <div class="custom-spacing-20px"></div>


        <!-- INTRO -->
        <div class="row">
          <div class="col s12">
            <p class="custom-intro-text">
              Choose what communications you’d like to receive from 3P Learning. We’re always
              trying to provide you with the most relevant information, ideas, tips and news – if you have
              any feedback, we’d love to hear it – reach out to <a href="https://support.3plearning.com">support@3plearning.com</a> with your thoughts!
            </p>
          </div>
        </div>




        <div class="row">
          <div class="col s12 xl6">




            <!-- MARKETING INTERESTS TITLE -->
            <div class="custom-spacing-20px"></div>
            <h6>Subscriptions:</h6>
            <div class="divider"></div>
            <div class="custom-spacing-20px"></div>            



            <!-- PRODUCT INFORMATION -->
            <div class="row">
              <div class="col">
                <div class="card-panel hoverable">
                  <div class="row">
                    <div class="valign-wrapper custom-min-height">
                      <div class="col s10">
                        <h5>Product Updates</h5>
                        <p>What’s new with 3P Learning products you’re following, like new features,
                          games
                          and activities, as well as bug-fixes, troubleshooting and upcoming
                          upgrades.
                        </p>
                      </div>
                      <div class="col s2">
                        <div class="switch">
                          <label>
                            <input type="checkbox" id="next_product_information" name="next_product_information" value="true" 
                                   %%=IIF(@PRODUCT_INFORMATION, 'checked', '')=%%>
                            <span class="lever custom-remove-margin"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>




            <!-- NEWSLETTER -->
            <div class="row">
              <div class="col">
                <div class="card-panel hoverable">
                  <div class="row">
                    <div class="valign-wrapper custom-min-height">
                      <div class="col s10">
                        <h5>Newsletter</h5>
                        <p>Get regular updates from the Team at 3P Learning, with insights, blogs,
                          resources, and what’s happening in the wonderful world of Edtech!</p>
                      </div>
                      <div class="col s2">
                        <div class="switch">
                          <label>
                            <input type="checkbox" id="next_newsletter" name="next_newsletter" value="true"
                                   %%=IIF(@NEWSLETTER, 'checked', '')=%%>
                            <span class="lever custom-remove-margin"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>




            <!-- PROMOTIONS -->
            <div class="row">
              <div class="col">
                <div class="card-panel hoverable">
                  <div class="row">
                    <div class="valign-wrapper custom-min-height">
                      <div class="col s10">
                        <h5>Features and Promotions</h5>
                        <p>See how the range of 3P Learning products can complement your students or
                          kids’ education, from maths, to spelling, to STEM and literacy
                          development.</p>
                      </div>
                      <div class="col s2">
                        <div class="switch">
                          <label>
                            <input type="checkbox" id="next_promotions" name="next_promotions" value="true"
                                   %%=IIF(@PROMOTIONS, 'checked', '')=%%>
                            <span class="lever custom-remove-margin"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>




          </div>
          <!-- DESKTOP RESPONSIVE -->
          <div class="col s12 xl6">




            <!-- PRODUCT INTERESTS TITLE -->
            <div class="custom-spacing-20px"></div>
            <h6>Product Interests:</h6>
            <div class="divider"></div>
            <div class="custom-spacing-20px"></div>




            <!-- MATHLETICS -->
            <div class="row">
              <div class="col">
                <div class="card-panel hoverable">
                  <div class="row">
                    <div class="valign-wrapper custom-min-height">
                      <div class="col s2 hide-on-small-and-down"> 
                        <img
                             src="https://image.my.3plearning.com/lib/fe3211717d640479701476/m/1/771a5b2b-bbd6-4361-98dc-30bd7114023a.png"
                             alt="Mathletics Logo" class="responsive-img circle grey lighten-3">
                      </div>
                      <div class="col s8">
                        <h5>Mathletics</h5>
                        <p>
                          Our world-famous mathematics program created by specialist educators to
                          support in-school or at-home learning.
                      </div>
                      <div class="col s2">
                        <!-- Switch -->
                        <div class="switch">
                          <label>
                            <input type="checkbox" id="next_mathletics" name="next_mathletics" value="true"
                                   %%=IIF(@MATHLETICS, 'checked', '')=%%>
                            <span class="lever custom-remove-margin"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>




            <!-- MATHSEEDS -->
            <div class="row">
              <div class="col">
                <div class="card-panel hoverable">
                  <div class="row">
                    <div class="valign-wrapper custom-min-height">
                      <div class="col s2 hide-on-small-and-down"> 
                        <img
                             src="https://image.my.3plearning.com/lib/fe3211717d640479701476/m/1/4431faf9-7f24-4201-9185-099241ab3c8a.png"
                             alt="Mathseeds Logo" class="responsive-img circle grey lighten-3">
                      </div>
                      <div class="col s8">
                        <h5>Mathseeds</h5>
                        <p>The engaging mathematics program designed to introduce numeracy and basic
                          mathematics to early learners..</p>
                      </div>
                      <div class="col s2">
                        <!-- Switch -->
                        <div class="switch">
                          <label>
                            <input type="checkbox" id="next_mathseeds" name="next_mathseeds" value="true"
                                   %%=IIF(@MATHSEEDS, 'checked', '')=%%>
                            <span class="lever custom-remove-margin"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>




            <!-- READING EGGS -->
            <div class="row">
              <div class="col">
                <div class="card-panel hoverable">
                  <div class="row">
                    <div class="valign-wrapper custom-min-height">
                      <div class="col s2 hide-on-small-and-down">
                        <img src="https://image.my.3plearning.com/lib/fe3211717d640479701476/m/1/705dc7c6-7a99-411d-9d93-36e796c7eb54.png"
                             alt="Reading Eggs Logo" class="responsive-img circle grey lighten-3">
                      </div>
                      <div class="col s8">
                        <h5>Reading Eggs</h5>
                        <p>The reading program packed with resources designed to entertain and
                          engage
                          young minds with reading and literacy. </p>
                      </div>
                      <div class="col s2">
                        <!-- Switch -->
                        <div class="switch">
                          <label>
                            <input type="checkbox" id="next_reading_eggs" name="next_reading_eggs" value="true"
                                   %%=IIF(@READING_EGGS, 'checked', '')=%%>
                            <span class="lever custom-remove-margin"></span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>





          </div>
        </div>
        <!-- //responsive desktop-->





        <!-- UNSUBSCRIBE -->
        <div class="row">
          <div class="col s12">
            <div class="custom-unsubscribe-panel">
              <div class="row">
                <div class="valign-wrapper custom-min-height">
                  <div class="col s10">
                    <h5>Subscribed to email</h5>
                    <p>Click here to unsubscribe from our news, articles, ideas, inspirations, and
                      promotional offers from 3P Learning.</p>
                  </div>
                  <div class="col s2">
                    <div class="switch">
                      <label>
                        <input type="checkbox" id="next_status" name="next_status" value="true"
                               %%=IIF(@STATUS != 'unsubscribed', 'checked', '')=%%>
                        <span class="lever custom-remove-margin"></span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>




        <!-- spacing -->
        <div class="custom-spacing-80px"></div>




        <!-- SAVE PREFERENCES -->
        <div class="row ">
          <div class="col s12">
            <button class="custom-submit-button right" type="submit">
              Save Preferences
            </button>
          </div>
        </div>




      </div>
      <!-- //content wrapper -->
    </form>




    <!-- spacing -->
    <div class="custom-spacing-100px"></div>




    <!-- FOOTER -->
    <footer>
      <div class="custom-footer">
        <div class="container">
          <div class="row">
            <div class="col s12">
              <p>
                <a href="http://www.3plearning.com/hello/">About Us</a>&nbsp;&nbsp;&#124;&nbsp;&nbsp;
                <a href="http://www.3plearning.com/careers/">Careers</a>&nbsp;&nbsp;&#124;&nbsp;
                <a href="http://www.3plearning.com/contact/">Contact Us</a>&nbsp;&nbsp;&#124;&nbsp;
                <a href="http://www.3plearning.com/privacy/">Privacy Policy</a>&nbsp;&nbsp;&#124;&nbsp;
                <a href="http://www.3plearning.com/terms/">Terms &amp; Conditions</a>
              </p>
              <div class="custom-spacing-20px"></div>
              <p>
                Copyright %%=Format(Now(), "yyyy")=%%.
                <a href="https://www.3plearning.com/">3P Learning</a>
                - Transforming lives through a love of learning.
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>




    <!-- =================== CUSTOM JAVASCRIPT =================== -->




    %%=Concat('<', 'script>')=%%



    /****************************************
    -- LOADING INDICATOR
    *****************************************/

    //dom
    let hiddenLoadingIndicator = document.querySelector('#dom-hidden-loading-indicator')    
    let preferencesForm = document.querySelector('#dom-preferences-form')

    //events
    window.addEventListener("load", () => {
    hiddenLoadingIndicator.style.display = "none"
    })
    preferencesForm.addEventListener("submit", ()=> {
    hiddenLoadingIndicator.style.display = "block"
    })



    /****************************************
    -- DATE PICKER
    *****************************************/

    //dom
    var datePickers = document.querySelectorAll('.datepicker');

    //config
    options = {
    autoClose: true,
    showClearBtn: true,
    format: 'dd mmmm yyyy',
    yearRange: 150,
    showDaysInNextAndPreviousMonths: true,
    defaultDate: new Date('%%=v(@BIRTHDATE)=%%'),
    setDefaultDate: true

    }

    //events
    window.addEventListener("load", () => {
    var instances = M.Datepicker.init(datePickers, options);
    })


    %%=Concat('</', 'script>')=%%




  </body>
</html>





