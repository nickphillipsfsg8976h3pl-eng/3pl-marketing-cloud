%%[
    /* 
     * Form Processing Page
     * Purpose: Process form submissions and handle lead creation, campaign membership, and redirection logic.
     * Description: This script handles the form submissions, processes the request parameters, and manages campaign and lead creation. It also includes debugging information and redirection logic.
     */

    set @form               = lowercase(RequestParameter('form')) 
    set @_Campaign_Name     = RequestParameter("campaign-name")
    set @_Triggered_Send_Key= RequestParameter("triggered-send-key")
    set @_Redirect_To_Page  = RequestParameter("redirect-to-page")
    set @RedirectId         = RequestParameter('rid') 
    set @pid                = RequestParameter('pid') 
    set @cid                = RequestParameter('cid') 
    set @_UTM_Campaign      = RequestParameter("utm-campaign")
    set @_UTM_Content       = RequestParameter("utm-content")
    set @_UTM_Medium        = RequestParameter("utm-medium")
    set @_UTM_Source        = RequestParameter("utm-source")
    set @_UTM_Term          = RequestParameter("utm-term")
    set @gclid              = RequestParameter("gclid")
    set @fbclid             = RequestParameter("fbclid")
    set @msclkid            = RequestParameter("msclkid")
    set @referrer           = RequestParameter("referrer")
    set @http_referrer      = HTTPRequestHeader("referer")
    set @debug              = RequestParameter('debug')

    set @_Product_Interest    = RequestParameter("product-interest")
    set @_User_interest       = RequestParameter("user_interest")
    set @_Submitter_Name      = RequestParameter("submitter-name")
    set @_Submitter_Notes      = RequestParameter("submitter-notes")
    set @_First_Name          = RequestParameter("first-name")
    set @_Last_Name           = RequestParameter("last-name")
    set @_Email_Address       = RequestParameter("email-address")
    set @_Phone_Number        = RequestParameter("phone-number")
    set @_Grade_Level         = RequestParameter("grade-level")
    set @_Job_Title           = RequestParameter("job_title_select")
    set @_Country_Name        = RequestParameter("country-name")
    set @_State_Name          = RequestParameter("state-name")
    set @_Postal_Code         = RequestParameter("postal-code")
    set @_School_Name         = RequestParameter("school-name")
    set @_No_Of_Licences      = RequestParameter("no-of-licences")
    set @_Terms_And_Conditions= RequestParameter("terms-and-conditions")
    set @_Subscriber_Opt_In   = RequestParameter("subscriber-opt-in")
    set @_Subject             = RequestParameter("subject_select")
    set @formattedSubjects    = ""

    if @_User_interest == 'quote' then 
            set @form = 'quote' 
    elseif @_User_interest == 'demo' then
            set @form = 'demo'
    elseif @_User_interest == 'trial' then
            set @form = 'trial'
    elseif @_User_interest == 'info' then
            set @form = 'info'
    endif

    /* Campaign Pre processing : Snippets @ 05_CLOUDPAGES --> Form Processing Snippets */
    output(concat(ContentBlockByKey("campaign_pre_process")))

    /* Lead Pre processing : Snippets @ 05_CLOUDPAGES --> Form Processing Snippets */
    output(concat(ContentBlockByKey("lead_pre_process")))

    /* Debug Information : Snippets @ 05_CLOUDPAGES --> Form Processing Snippets */
    output(concat(ContentBlockByKey("debug_form_stage1")))

    /* Lead Submission Queue Logic */
    output(concat(ContentBlockByKey("lead_submission_queue")))
    
/* Thank you message */
output(concat(
  "<div style='font-family: Arial, sans-serif; font-size: 16px; color: #333; background-color: #f8f8f8; padding: 20px; border: 1px solid #ddd; border-radius: 8px; max-width: 600px; margin: 20px auto;'>",
    "<h2 style='color: #0070c0; margin-top: 0;'>Thank you for your submission!</h2>",
    "<p style='margin-bottom: 10px;'>Your details have been received successfully and are being processed.</p>",
    "<p style='margin-bottom: 10px;'>Please allow up to <strong>1 hour</strong> before checking the CRM system for this submission.</p>",
    "<p style='font-size: 14px; color: #666; margin-bottom: 0;'>If you have any questions, please contact the marketing ops support team.</p>",
  "</div>"
))

if @debug == true then
  output(concat(
    "<div style='font-family: Arial, sans-serif; font-size:14px; line-height:1.6; padding:10px; border-bottom:1px solid #ccc;'>",
    "<strong style='color:#444;'>SubmissionId:</strong> <span style='color:#0070c0;'>", @SubmissionId, "</span><br>",
    "<strong style='color:#444;'>SubmittedDate:</strong> <span style='color:#0070c0;'>", @SubmittedDate, "</span><br>",
    "<strong style='color:#444;'>FirstName:</strong> <span style='color:#0070c0;'>", @_First_Name, "</span><br>",
    "<strong style='color:#444;'>LastName:</strong> <span style='color:#0070c0;'>", @_Last_Name, "</span><br>",
    "<strong style='color:#444;'>Email:</strong> <span style='color:#0070c0;'>", @_Email_Address, "</span><br>",
    "<strong style='color:#444;'>Phone:</strong> <span style='color:#0070c0;'>", RequestParameter("phone-number"), "</span><br>",
    "<strong style='color:#444;'>Country:</strong> <span style='color:#0070c0;'>", RequestParameter("country-name"), "</span><br>",
    "<strong style='color:#444;'>School:</strong> <span style='color:#0070c0;'>", RequestParameter("school-name"), "</span><br>",
    "<strong style='color:#444;'>State:</strong> <span style='color:#0070c0;'>", RequestParameter("state-name"), "</span><br>",
    "<strong style='color:#444;'>JobTitle:</strong> <span style='color:#0070c0;'>", RequestParameter("job_title_select"), "</span><br>",
    "<strong style='color:#444;'>GradeLevel:</strong> <span style='color:#0070c0;'>", RequestParameter("grade-level"), "</span><br>",
    "<strong style='color:#444;'>CampaignId:</strong> <span style='color:#0070c0;'>", RequestParameter("campaign-name"), "</span><br>",
    "<strong style='color:#444;'>PostCode:</strong> <span style='color:#0070c0;'>", RequestParameter("postal-code"), "</span><br>",
    "<strong style='color:#444;'>Licenses:</strong> <span style='color:#0070c0;'>", RequestParameter("no-of-licences"), "</span><br>",
    "<strong style='color:#444;'>ProductInterest:</strong> <span style='color:#0070c0;'>", RequestParameter("product-interest"), "</span><br>",
    "<strong style='color:#444;'>TermsAccepted:</strong> <span style='color:#0070c0;'>", RequestParameter("terms-and-conditions"), "</span><br>",
    "<strong style='color:#444;'>SubscriberOptIn:</strong> <span style='color:#0070c0;'>", RequestParameter("subscriber-opt-in"), "</span><br>",
    "<hr style='border: none; height: 4px; background-color: #FFCC00; margin: 20px 0;'>",
    "<strong style='color:#444;'>Submitter:</strong> <span style='color:#0070c0;'>", @_Submitter_Name, "</span><br>",
    "<strong style='color:#444;'>SubmitterNotes:</strong> <span style='color:#0070c0;'>", @_Submitter_Notes, "</span><br>",
    "</div>"
  ))
endif
    
]%%

