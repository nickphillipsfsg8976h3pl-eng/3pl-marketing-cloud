<script runat="server">
Platform.Load("core", "1.1.1");

var result = [];

try {
  var de = DataExtension.Init("state");
  var rows = de.Rows.Lookup("Active", "True");

  for (var i = 0; i < rows.length; i++) {
    var row = rows[i];
    result.push({
      "State Name": row["State Name"],
      "State Code": row["State Code"],
      "Country Code": row["Country Code"]
    });
  }

  Platform.Response.SetResponseHeader("Content-Type", "application/json");
  Write(Stringify(result));
} catch(e) {
  Platform.Response.SetResponseHeader("Content-Type", "application/json");
  Write(Stringify({ error: e.message }));
}
</script>
