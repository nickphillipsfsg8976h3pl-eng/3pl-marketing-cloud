%%[
SET @subscriberkey = _SubscriberKey
SET @JobID = jobID
SET @listid = listid
SET @batchid = _JobSubscriberBatchID


/* Is this a lead or a contact*/
 IF Substring(@subscriberkey,1,3) == '003' THEN
    SET @type = "Contact_Salesforce_8"
     SET @updatetype = "Contact"
    ELSEIF Substring(@subscriberkey,1,3) == '00Q' THEN
     SET @type = "Lead_Salesforce_8"
   SET @updatetype = "Lead"
 ELSE Redirect(CloudPagesURL(1853))
 ENDIF


/*kept receiving errors trying to LookUpRows for the objects so am looking up the CRM instead*/
SET @lookupsubscriber = RetrieveSalesforceObjects(@updatetype, "Email,HasOptedOutOfEmail,Marketing_Interest__c,Marketing_Product_Interest__c","Id", "=", @subscriberkey)
IF RowCount(@lookupsubscriber) == 1 THEN /* there should only be one row */
    SET @subscriberRow = Row(@lookupsubscriber, 1)
    SET @email = Field(@subscriberRow, "Email")
 SET @marketingproductinterest = Field(@subscriberRow, "Marketing_Product_Interest__c")
 SET @marketinginterest = Field(@subscriberRow, "Marketing_Interest__c")
 SET @unsuball = Field(@subscriberRow, "HasOptedOutOfEmail")
          
ELSE Redirect(CloudPagesURL(1853))
ENDIF

IF @unsuball == false THEN
 SET @unsuballresult = ''
ELSE 
 SET @unsuballresult = 'checked="yes"'
ENDIF

/*Check the Marketing Interest values in the field and populate the selections*/
SET @prodinfo = 'Product information'
IF IndexOf(@marketinginterest,@prodinfo) > 0 THEN
 SET @product = 'checked="yes"'
ELSE 
 SET @product = ''
ENDIF
          
SET @newsl = 'Newsletter'
IF IndexOf(@marketinginterest,@newsl) > 0 THEN
 SET @newsletter = 'checked="yes"'
ELSE 
 SET @newsletter = ''
ENDIF
          
SET @promos = 'Promotions'
IF IndexOf(@marketinginterest,@promos) > 0 THEN
 SET @featpromos = 'checked="yes"'
ELSE 
 SET @featpromos = ''
ENDIF
]%%

<!DOCTYPE html>
<html>
    <head>
        <!--Import Google Icon Font-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!--Import materialize.css-->
        <link type="text/css" rel="stylesheet" href="https://cloud.mc3.3plearning.com/prefcentrecss"  media="screen,projection"/>

        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <style>
        </style>
      
    </head>
<script>
   function validate(event) {
    event.preventDefault();
    
 hideAllErrorMsg();
  var flagValidation = true;
 var emailPattern = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    var validationStuff = '<span for="emailAdress" class="error-label" style="display: inline;"></span><span class="tooltip-arrow-error-msg"></span>';
 
 if (!($('#EmailAddress').val())) {
  flagValidation = false;
  $('#EmailAddressErr').show().html('Please enter email address.' + validationStuff);
  $('#EmailAddress').css('border', '2px solid #ff0000');
 } else if (!emailPattern.test($('#EmailAddress').val())) {
  // email address is not valid
  flagValidation = false;
  $('#EmailAddressErr').show().html("Please enter a valid email address." + validationStuff);
  $('#EmailAddress').css('border', '2px solid #ff0000');
 } else {
   /*email address is valid - show the reconfirm email box */
  $('#EmailAddressErr').hide().html("");
  $('#EmailAddress').css('border', '2px solid #adadad');
 }
   }
  </script>
    <body class="">
        <nav class="" role="navigation">
            <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo"><img src="http://image.mc3.3plearning.com/lib/fe9413737461017874/m/1/89df9399-8e0e-4ec7-a372-ad9f86ff4b8b.png"/></a>
            </div>
        </nav>
        <body> 
   <div class="container">
                <form action="https://cloud.mc3.3plearning.com/preferencecentreprocessing" method="POST" id="datacapture">
                    <div class="row">
                        <div class="col xl6 l12 m12 s12">
                            <div class="section">
                                <h1 class="header">Update your email preferences</h1>
                                <p class="">Choose what communications you’d like to receive from 3P Learning. We’re always trying to provide you with the most relevant information, ideas, tips and news – if you have any feedback, we’d love to hear it – reach out to support@3plearning.com with your thoughts! <br>
<br>


Here are the communications you’re currently receiving: </p>
                                <div class="row">
                                    <div class="col l12 m12 s12">
                                        <div class="input-field">
                                            <input value="%%=v(@email)=%%" placeholder="%%=v(@email)=%%" id="EmailAddress" type="text" class="validate" disabled>
                                                      <label id="EmailAddressErr" class="tooltip-error-msg bottom error errMsg"><span class="error-label" style="display: inline;"></span> <span class="tooltip-arrow-error-msg"></span></label>
                                          <label for="EmailAddress">Email Address</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                          <!-- Hidden -->
                          <div>
                          <input type="hidden" id="subscriberkey" name="subscriberkey" value="%%=v(@subscriberkey)=%%" />
                          </div>
                                                    <div>
                          <input type="hidden" id="typeofcontact" name="typeofcontact" value="%%=v(@updatetype)=%%" />
                          </div>
                            <div class="section">
                                <p class="">Here are the email types you currently receive:</p>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l10 m10 s10">
                                        <h3 class="">Product Updates</h3>
                                        <p>What’s new with 3P Learning products you’re following, like new features, games and activities, as well as bug-fixes, troubleshooting and upcoming upgrades.  </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                     <input type="checkbox" id="product" name="product" value="1" %%=v(@product)=%%> 
                                                <span class="lever"></span>
                                            </label>
                                        </div>    
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col l10 m10 s10">

                                    </div>
                                    <div class="col l2 m2 s2">
                                    </div>
                                </div>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l10 m10 s10">
                                        <h3 class="">Newsletter</h3>
                                        <p>Get regular updates from the Team at 3P Learning, with insights, blogs, resources, and what’s happening in the wonderful world of Edtech!</p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="newsletter" name="newsletter" value="1" %%=v(@newsletter)=%%>       
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col l10 m10 s10">
                                    </div>
                                    <div class="col l2 m2 s2">
                                    </div>
                                </div>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l10 m10 s10">
                                        <h3 class="">Features and Promotions</h3>
                                        <p>See how the range of 3P Learning products can complement your students or kids’ education, from maths, to spelling, to STEM and literacy development. </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="features" name="features" value="1" %%=v(@featpromos)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col l10 m10 s10">

                                    </div>
                                    <div class="col l2 m2 s2">
                                    </div>
                                </div>
                                
                            </div>
                            <div class="row">
                                <div class="col l10 m10 s10">
                                </div>
                                <div class="col l2 m2 s2">
                                </div>
                            </div>
                            <div class="section">
                                <p class="">Here are the products you are receiving information about:</p>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l3 m2 hide-on-small-and-down">
                                        <img src="http://image.mc3.3plearning.com/lib/fe9413737461017874/m/1/6fdcd289-0d41-4aa1-bc51-a94698942c3e.png" alt="Mathletics Logo" class="responsive-img circle grey lighten-3">
                                    </div>
                                    <div class="col l7 m8 s10">
%%[/* Check the Marketing Product Interest values in the field and populate the selections*/
SET @rowinterests = BuildRowsetFromString(@marketingproductinterest,";")
    for @i = 1 to Rowcount(@rowinterests) do
  SET @row = Row(@rowinterests,@i)
  SET @value = Field(@row,1)
 IF @value == 'Mathletics' THEN
  SET @mathletics = 'checked="yes"'
 ELSEIF @value == 'Spellodrome' THEN
  SET @spellodrome = 'checked="yes"'
 ELSEIF @value == 'ReadingEggs' THEN
  SET @readingeggs = 'checked="yes"'                                      
 ELSEIF @value == 'Mathseeds' THEN
  SET @mathseeds = 'checked="yes"'
 ELSEIF @value == 'WordFlyers' THEN
     SET @WordFlyers = 'checked="yes"'                                  
 ELSEIF @value == 'Readiwriter-Phonics' THEN
  SET @readiwriterphonics = 'checked="yes"'
 ELSEIF @value == 'MathleticsPlay' THEN
  SET @MathleticsPlay = 'checked="yes"'
 ELSEIF @value == 'Gooseberry Planet' THEN
  SET @gooseberry = 'checked="yes"'
 ELSEIF @value == 'WordFlyers' THEN
  SET @WordFlyers = 'checked="yes"'
 ELSEIF @value == 'STEMscopes' THEN
  SET @stem = 'checked="yes"'
 ELSE 
  SET @result = 'No Interests'
 ENDIF
 next @i
 endif
]%%
                                        <h3 class="">Mathletics</h3>
<p>Our world-famous mathematics program created by specialist educators to support in-school or at-home learning. Used by over 200,000 teachers and loved by more than 3 million learners around the world. </p>

                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="mathletics" name="mathletics" value="1" %%=v(@mathletics)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l3 m2 hide-on-small-and-down">
                                        <img src="http://image.mc3.3plearning.com/lib/fe9413737461017874/m/1/a7c9fd53-bcd7-4feb-845c-d6ed41c3ac9b.png" alt="Spellodrome Logo" class="responsive-img circle grey lighten-3">
                                    </div>
                                    <div class="col l7 m8 s10">
                                        <h3 class="">Spellodrome</h3>
          <p>The spelling program focusing on critical spelling awareness and independent writing development.    </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="spellodrome" name="spellodrome" value="1" %%=v(@spellodrome)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l3 m2 hide-on-small-and-down">
                                        <img src="https://image.my.3plearning.com/lib/fe9413737461017874/m/1/96651f9c-b1d1-4a21-b40e-1fd0c9f38db9.png" alt="Reading Eggs Logo" class="responsive-img circle grey lighten-3">
                                    </div>
                                    <div class="col l7 m8 s10">
                                        <h3 class="">Reading Eggs</h3>
            <p>The multi-award-winning reading program for children aged 2-13.  </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="readingeggs" name="readingeggs" value="1" %%=v(@readingeggs)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l3 m2 hide-on-small-and-down">
                                        <img src="http://image.mc3.3plearning.com/lib/fe9413737461017874/m/1/e5bdaed3-218a-4d74-9b2a-d9b836e9e20c.png" alt="Mathseeds Logo" class="responsive-img circle grey lighten-3">
                                    </div>
                                    <div class="col l7 m8 s10">
                                        <h3 class="">Mathseeds</h3>
          <p>The comprehensive online mathematics program for children aged 3-9.    </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="mathseeds" name="mathseeds" value="1" %%=v(@mathseeds)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l3 m2 hide-on-small-and-down">
                                        <img src="http://image.mc3.3plearning.com/lib/fe9413737461017874/m/1/464b707c-0d38-4b7a-a3e1-1d25165a7c2b.png" alt="Stemscopes Logo" class="responsive-img circle grey lighten-3">
                                    </div>
                                    <div class="col l7 m8 s10">
                                        <h3 class="">Stemscopes</h3>
          <p>The world’s most current, continuously updated digital science curriculum     </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="stemscopes" name="stemscopes" value="1" %%=v(@stem)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l3 m2 hide-on-small-and-down">
                                        <img src="http://image.mc3.3plearning.com/lib/fe9413737461017874/m/1/90241295-ca84-4688-9cc5-6b8d9eb1cf61.png" alt="Gooseberry Planet Logo" class="responsive-img circle grey lighten-3">
                                    </div>
                                    <div class="col l7 m8 s10">
                                        <h3 class="">Gooseberry Planet</h3>
           <p>Our comprehensive online safety program helping students navigate the online world safely.    </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="gooseberry" name="gooseberry" value="1" %%=v(@gooseberry)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
              <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l3 m2 hide-on-small-and-down">
                                        <img src="http://image.my.3plearning.com/lib/fe9413737461017874/m/1/35168f26-dc77-41ea-8298-a2f792376f70.png" alt="Wordflyers Logo" class="responsive-img circle grey lighten-3">
                                    </div>
                                    <div class="col l7 m8 s10">
                                        <h3 class="">WordFlyers</h3>
           <p> WordFlyers is a literacy skill-building program for Years 7-10, supporting students with their grammar, reading, comprehension, punctuation vocabulary and writing.   </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="wordflyers" name="wordflyers" value="1" %%=v(@WordFlyers)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                              <div class="row valign-wrapper card-panel hoverable">
                                    <div class="col l10 m10 s10">
                                        <h3 class="">Unsubscribe from all marketing emails</h3>
                                        <p>Click here to unsubscribe from our news, articles, ideas, inspirations, and promotional offers from 3P Learning. </p>
                                    </div>
                                    <div class="col l2 m2 s3">
                                        <!-- Switch -->
                                        <div class="switch">
                                            <label>
                                                <input type="checkbox" id="unsubfromall" name="unsubfromall" value="1" %%=v(@unsuballresult)=%%>
                                                <span class="lever"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                           <input type="hidden" id="subkey" name="subkey" value="%%=v(@subscriberkey)=%%">
                        <input type="hidden" id="type" name="type" value="%%=v(@updatetype)=%%">
                        <input type="hidden" id="JobID" name="JobID" value="%%=v(@JobID)=%%">
                        <input type="hidden" id="listid" name="listid" value="%%=v(@listid)=%%">
                        <input type="hidden" id="batchid" name="batchid" value="%%=v(@batchid)=%%">
                        <input type="hidden" id="email" name="email" value="%%=v(@email)=%%">
                            <div class="row section">
                                <button class="btn waves-effect waves-light" type="submit" name="action">Save Preferences</button>
                            </div>
                            <br />
                        </div>
                        <div class="col l6">
                        </div>
                    </div><!--END LEFT ROW-->
                </form><!--END FORM-->
            </div><!--END CONTAINER-->
            <footer class="page-footer">
                <div class="footer-copyright">
                    <div class="container">
                        <div class="row">
                            <div class="col l6 m12 s12 left-align copyright-left">
                                <p class="">Copyright %%=Format(Now(), "yyyy")=%%. <a href="https://www.3plearning.com/">3P Learning</a> - Transforming lives through a love of learning.</p>
                            </div>
                            <div class="col l6 m12 s12 right-align copyright-right">
                                <p class="grey-text darken-3">
                                    <a class="" href="http://www.3plearning.com/hello/">About Us</a>&nbsp;&nbsp;&#124;&nbsp;
                                    <a class="" href="http://www.3plearning.com/careers/">Careers</a>&nbsp;&nbsp;&#124;&nbsp;
                                    <a class="" href="http://www.3plearning.com/contact/">Contact Us</a>&nbsp;&nbsp;&#124;&nbsp;
                                    <a class="" href="http://www.3plearning.com/privacy/">Privacy Policy</a>&nbsp;&nbsp;&#124;&nbsp;
                                    <a class="" href="http://www.3plearning.com/terms/">Terms &amp; Conditions</a>
                                </p>
                            </div>
                        </div>
                    </div><!--END CONTAINER-->
                </div><!--END FOOTER-->
            </footer>
        </body>

        <!--JavaScript at end of body for optimized loading-->
        <script type="text/javascript" src="https://cloud.mc3.3plearning.com/prefcentrejs"></script>
    </body>
</html>


