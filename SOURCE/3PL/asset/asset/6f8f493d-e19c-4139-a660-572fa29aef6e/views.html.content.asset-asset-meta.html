<!-- 
=========================================
----------- GLOBAL FORM HTML ------------
=========================================

NOTES:
- clean up
- refine job titles and coutries ampscript
- add bootstrap validation
- clean up 3p js
- add in request parameter logic (?type=BOF/TOF -> BOF=2346 etc.)
- discuss multiple select box alternatives (simple checkboxes, selectable icons, no multiple, multiple options instead of multiple select, other pre-mades, bootstrap standard)
- dicuss hidden parametres to pass through
- redirectTO form
- XSRF Token
- add custom validation (joi.js)
- remove custom hides, change to d-none's
-->



<script runat="server" >
  Platform.Load("core","1");




  /************************* 
  --------- FORMS ----------
  **************************/


  var FORM_TEMPLATES = {

    //?form=master
    master: [
      "PRODUCT_INTEREST",
      "FIRST_NAME",
      "LAST_NAME",
      "EMAIL_ADDRESS",
      "PHONE_NUMBER",
      "GRADE_LEVEL",
      "JOB_TITLE",
      "COUNTRY_NAME",
      "STATE_NAME",
      "POSTAL_CODE",
      "SCHOOL_NAME",
      "NO_OF_LICENCES",
      "TERMS_AND_CONDITIONS",
      "SUBSCRIBER_OPT_IN",
      "SUBMIT_BUTTON"
    ],

    //?form=basic
    required: [
      "FIRST_NAME",
      "LAST_NAME",
      "EMAIL_ADDRESS",
      "SCHOOL_NAME",
      "COUNTRY_NAME",
      "STATE_NAME",
      "TERMS_AND_CONDITIONS",
      "SUBSCRIBER_OPT_IN",
      "SUBMIT_BUTTON"
    ],

    //?form=tof
    tof: [
      "FIRST_NAME",
      "LAST_NAME",
      "EMAIL_ADDRESS",
      "JOB_TITLE",
      "SCHOOL_NAME",
      "COUNTRY_NAME",
      "STATE_NAME",
      "TERMS_AND_CONDITIONS",
      "SUBSCRIBER_OPT_IN",
      "SUBMIT_BUTTON"
    ],

    //?form=bof
    bof: [
      "FIRST_NAME",
      "LAST_NAME",
      "EMAIL_ADDRESS",
      "PHONE_NUMBER",
      "JOB_TITLE",
      "COUNTRY_NAME",
      "STATE_NAME",
      "POSTAL_CODE",
      "SCHOOL_NAME",
      "TERMS_AND_CONDITIONS",
      "SUBSCRIBER_OPT_IN",
      "SUBMIT_BUTTON"
    ],

    //?form=quote
    quote: [
      "PRODUCT_INTEREST",
      "FIRST_NAME",
      "LAST_NAME",
      "EMAIL_ADDRESS",
      "COUNTRY_NAME",
      "STATE_NAME",
      "POSTAL_CODE",
      "SCHOOL_NAME",
      "PHONE_NUMBER",
      "JOB_TITLE",
      "GRADE_LEVEL",
      "NO_OF_LICENCES",
      "TERMS_AND_CONDITIONS",
      "SUBSCRIBER_OPT_IN",
      "SUBMIT_BUTTON"
    ],


        //?form=trial
    trial: [
      "FIRST_NAME",
      "LAST_NAME",
      "EMAIL_ADDRESS",
      "PHONE_NUMBER",
      "SCHOOL_NAME",
      "JOB_TITLE",
      "COUNTRY_NAME",
      "STATE_NAME",
      "POSTAL_CODE",
      "TERMS_AND_CONDITIONS",
      "SUBSCRIBER_OPT_IN",
      "SUBMIT_BUTTON"
    ],

    
    demo: [
      "FIRST_NAME",
      "LAST_NAME",
      "EMAIL_ADDRESS",
      "PHONE_NUMBER",
      "SCHOOL_NAME",
      "JOB_TITLE",
      "COUNTRY_NAME",
      "STATE_NAME",
      "POSTAL_CODE",
      "NO_OF_LICENCES",
      "TERMS_AND_CONDITIONS",
      "SUBSCRIBER_OPT_IN",
      "SUBMIT_BUTTON"
    ]
    
  }//FORM_TEMPLATE



  /*******************************
  ----- CHOOSE FORM TEMPLATE -----
  ********************************/


  //?form=( master | tof | bof )...etc
  var _form = Request.GetQueryStringParameter("form")
  _form = _form && _form.toLowerCase();
  if (_form) {
    var formFields = FORM_TEMPLATES[_form]
    for (var i=0; i<formFields.length; i++) {
      Variable.SetValue(formFields[i], "true");
    }//for
  }//if




  /************************************
  ----- &/OR CHOOSE SINGLE FIELDS -----
  *************************************/


  //?fields=etc,etc,etc
  var _fields = Request.GetQueryStringParameter("fields")
  _fields = _fields && _fields.toUpperCase().split(',');
  if (_fields) {
    for(var i=0; i<_fields.length; i++) {
      var _fields_field = _fields[i]
      Variable.SetValue(_fields_field, "true") 
    }//for    
  }//if




  /*******************************
  -- GENERAL REQUEST PARAMETER ---
  ********************************/


  Variable.SetValue('_Debug', Request.GetQueryStringParameter("debug")) 

  Variable.SetValue('_Campaign_Name', Request.GetQueryStringParameter("cid")) 
  Variable.SetValue('_Triggered_Send_Key', Request.GetQueryStringParameter("triggered_send_key")) 
  Variable.SetValue('_Redirect_To_Page', Request.GetQueryStringParameter("redirect_to_page")) 

  Variable.SetValue('_UTM_Source', Request.GetQueryStringParameter("utm_source")) 
  Variable.SetValue('_UTM_Medium', Request.GetQueryStringParameter("utm_medium")) 
  Variable.SetValue('_UTM_Campaign', Request.GetQueryStringParameter("utm_campaign")) 
  Variable.SetValue('_UTM_Content', Request.GetQueryStringParameter("utm_content")) 
  Variable.SetValue('_UTM_Term', Request.GetQueryStringParameter("utm_term")) 
  Variable.SetValue('gclid', Request.GetQueryStringParameter("gclid"))
    Variable.SetValue('_First_Name', Request.GetQueryStringParameter("first-name"))






  /*******************************
  ----------- SECURITY -----------
  ********************************/


  Platform.Response.SetResponseHeader("Strict-Transport-Security","max-age=200");
  Platform.Response.SetResponseHeader("X-XSS-Protection","1; mode=block");
 // Platform.Response.SetResponseHeader("X-Frame-Options","Deny");
  Platform.Response.SetResponseHeader("X-Content-Type-Options","nosniff");
  Platform.Response.SetResponseHeader("Referrer-Policy","strict-origin-when-cross-origin");
  //Platform.Response.SetResponseHeader("Content-Security-Policy","default-src 'self'");


</script>


<!-- =============================== HTML =============================== -->
%%[

        /*set @RedirectId         = RequestParameter("rid") 
        set @pid                = RequestParameter("pid") 
        set @cid                = RequestParameter("cid")
        set @_Campaign_Name     = RequestParameter("cid")
        set @CampaignMemId = RequestParameter("CampaignMemId")
      
        set @_Last_Name         = RequestParameter("last-name")
        set @_Email_Address     = RequestParameter("email-address")
        set @_Country_Name      = RequestParameter("country-name")
        set @LeadID             = RequestParameter("LeadID")
        
        set @Product            = LowerCase(RequestParameter("pid"))
        set @form               = RequestParameter("form")
        set @fields             = queryparameter("fields")
        set @_Terms_And_Conditions= RequestParameter("terms-and-conditions")
        set @_Subscriber_Opt_In   = RequestParameter("subscriber-opt-in")*/

        set @GUID               = RequestParameter("GUID")


        var @rows, @row, @rowCount
        var @LeadID, @_First_Name, @_Last_Name, @_Email_Address, @_Country_Name,@RedirectId,@pid,@cid
        var @_Campaign_Name,@CampaignMemId,@Product,@form,@_Terms_And_Conditions,@_Subscriber_Opt_In 

        /* Lookup rows in your data extension */
        set @rows = LookupRows("Forms_Log_2_StageLP_RE","GUID",@GUID)
        set @rowCount = RowCount(@rows)


        if @rowCount == 1 then

          for @i = 1 to @rowCount do
            set @row                   = Row(@rows,@i) 
            set @LeadID                = Field(@row,"LeadId")
            set @_First_Name           = Field(@row,"FirstName")
            set @_Last_Name            = Field(@row,"LastName")
            set @_Email_Address        = Field(@row,"Email")
            set @_Country_Name         = Field(@row,"Country")
            set @_Job_Title            = Field(@row,"JobTitle")
            set @RedirectId            = Field(@row,"RedirectId")
            set @pid                   = Field(@row,"PID")
            set @cid                   = Field(@row,"CampaignName")
            set @_Campaign_Name        = Field(@row,"CampaignName")
            set @CampaignMemId         = Field(@row,"CampaignMemberID")
            set @Product               = Field(@row,"PID")
            set @form                  = Field(@row,"Form")
            set @_Terms_And_Conditions = Field(@row,"TermsAndConditions")
            set @_Subscriber_Opt_In    = Field(@row,"OptIn")
            
          next @i
        else        
        endIf

]%%

<!doctype html>
<html lang="en">
  <head>
<!-- Google Tag Manager -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/libphonenumber-js/1.9.19/libphonenumber-js.min.js"></script>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P2KZRWQ');</script>
<!-- End Google Tag Manager -->

    <!-- Meta/SEO -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Form">



    <!-- Title & Favicons -->
    <title> 3PLearning | ReadingEggs Global Form2 </title>
    <link rel="shortcut icon" href="https://image.mc1.3plearning.com/lib/fe95137375660d7974/m/1/Mathletics-Favicon-16px.png" type="image/x-icon" />
    <link rel="apple-touch-icon-precomposed" href="https://image.mc1.3plearning.com/lib/fe95137375660d7974/m/1/Mathletics-Favicon-57px.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://image.mc1.3plearning.com/lib/fe95137375660d7974/m/1/Mathletics-Favicon-114px.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://image.mc1.3plearning.com/lib/fe95137375660d7974/m/1/Mathletics-Favicon-72px.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://image.mc1.3plearning.com/lib/fe95137375660d7974/m/1/Mathletics-Favicon-144.png">



    <!-- CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet"href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">



    <!-- Styles -->
    <style>
      /* font & colors
      ******************/
 :root {
   font-size: 16px;
   font-family: Open sans, helvetica, arial, sans-serif;
   font-weight: 400;
   color: #545454;

   --submit_button__rest--backgroundColor: #CB378C;
   --submit_button__rest--color :whitesmoke;
   --submit_button__hover--backgroundColor: #d92f9c;
   --submit_button__hover--color: white;
   --checkbox__rest--backgroundColor: lightgrey;
   --checkbox__hover--backgroundColor: #1981c4;
   --checkbox__checked--backgroundColor: #308ECB ;
   --valid_input--color: green;
   --invalid_input--color: red;
   --invalid_label--color: red;
 }
      /*
      custom submit button
      *********************/
      .custom_submit_button {
        background-color: var(--submit_button__rest--backgroundColor);
        border-radius: 25px;
        padding: 15px 50px;
        text-align: center;
        color: var(--submit_button__rest--color);
        font-weight: 600;
        font-size: 1rem;
        width: 100%;
         border: none;
      }
      .custom_submit_button:hover {
        background-color: var(--submit_button__hover--backgroundColor);
        color: var(--submit_button__hover--color);
      }
      .custom_submit_button:focus {
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgb(0 123 255 / 25%);
      }
      @media screen and (min-width: 767px) {
        .custom_submit_button {
          width: auto;
          float: right;
        }
      }
      /*
      custom check boxes
      *******************/
      .custom-checkbox {
        display: block;
        position: relative;
        padding-left: 35px;
        margin-bottom: 12px;
        cursor: pointer;
        font-size: 16px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .custom-checkbox input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }
      .checkmark {
        position: absolute;
        top: 5px;
        left: 0;
        height: 25px;
        width: 25px;
        background-color: var(--checkbox__rest--backgroundColor);
        border-radius: 5px;

      }
      .custom-checkbox:hover input~.checkmark {
        background-color: var(--checkbox__hover--backgroundColor);
      }
      .custom-checkbox input:checked~.checkmark {
        background-color: var(--checkbox__checked--backgroundColor);
      }
      .checkmark:after {
        content: "";
        position: absolute;
        display: none;
      }
      .custom-checkbox input:checked~.checkmark:after {
        display: block;
      }
      .custom-checkbox .checkmark:after {
        left: 9px;
        top: 5px;
        width: 7px;
        height: 15px;
        border: solid white;
        border-width: 0 3px 3px 0;
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
      }
      /* Fields
      ****************/
      .custom-field-label {
        font-weight: bold;
      }
      .custom-field-terms {
        font-weight: lighter;
        color: #495057;
      }
      /* Utility
      ****************/
      .custom-hide { display: none; }
      .custom-valid-input { border: 3px solid var(--valid_input--color) !important; }
      .custom-invalid-input { border: 3px solid var(--invalid_input--color) !important; }
      .custom-invalid-label { color: var(--invalid_label--color) !important; }

  .required-marker {
    position: absolute;
    top: 10px;
    left: 5px;
    color: red;
  }
    </style>
    
    
    

  </head>




  <!-- =============================== BODY =========================== -->  
  <body>
    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P2KZRWQ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    
    <form id="RE_globalForm_2LP22"
          action="http://my.readingeggs.com/re_form_processing_lp2" 
          method="POST" 
          target="_parent"
          onsubmit="return checkForm(this);"
          >






      <!------------- Hidden ----------------->

      <input type="hidden" name="debug" value="%%=v(@_Debug)=%%">

      <input type="hidden" name="campaign-name" value="%%=v(@_Campaign_Name)=%%">
      <input type="hidden" name="triggered-send-key" value="%%=v(@_Triggered_Send_Key)=%%">
      <input type="hidden" id="pid" name="pid" value="%%=v(@pid)=%%">
      <input type="hidden" id="eid" name="eid" value="%%=v(@enquiry)=%%">
      <input type="hidden" id="rid" name="rid" value="%%=v(@RedirectId)=%%">
      <input type="hidden" name="redirect-to-page" value="%%=v(@_Redirect_To_Page)=%%">
      <input type="hidden" id="form" name="form" value="%%=v(@form)=%%">
      <input type="hidden" id="utm-source" name="utm-source" value="%%=v(@_UTM_Source)=%%">
      <input type="hidden" id="utm-medium" name="utm-medium" value="%%=v(@_UTM_Medium)=%%">
      <input type="hidden" id="utm-campaign" name="utm-campaign" value="%%=v(@_UTM_Campaign)=%%">
      <input type="hidden" id="utm-content" name="utm-content" value="%%=v(@_UTM_Content)=%%">
      <input type="hidden" id="utm-term" name="utm-term" value="%%=v(@_UTM_Term)=%%">
      <input type="hidden" id="countrycode" name="countrycode" value="%%=v(@Country_Code)=%%">
      <input type="hidden" id="gclid" name="gclid" value="%%=v(@gclid)=%%">
      <input type="hidden" id="referrer" name="referrer" value="">
      <input type="hidden" id="cid "name="cid" value="%%=v(@cid)=%%">
      <input type="hidden" id="LeadID" name="LeadID" value="%%=v(@LeadID)=%%">
      <input type="hidden" id="CampaignMemId" name="CampaignMemId" value="%%=v(@CampaignMemId)=%%">
      <input type="hidden" id="GUID" name="GUID" value="%%=v(@GUID)=%%">


      <!-- Wrapper -->
      <div class=" container my-5">
        <div class="row">
          <div class="col">




   %%[
if indexOf(@product, "mathletics") > 0 then
  set @mathletics = 1
endif
if indexOf(@product, "mathseeds") > 0 then
  set @mathseeds = 1
endif
if indexOf(@product, "readingeggs") > 0 then
  set @readingeggs = 1
endif
]%%  




            <!------------- Product Interest ----------------->

            %%[If @PRODUCT_INTEREST Then]%%
            <div class="row">
              <div class="col">
                <div class="form-group">
                  <label for="product_interest_select" class="custom-field-label">
                  PRODUCT INTERESTS 
                  </label>
                  <select class="form-control selectpicker show-tick" 
                          id="product_interest_select"
                          name="product-interest" 
                          multiple 
                          title="Select Your Product Interests"
                          data-selected-text-format="values"
                          data-actions-box="true" 
                          required
                          style="color:#495057c7; font-weight: 400;"
                          >

                    <option value="mathletics" %%=IIF(not empty(@mathletics), "Selected", "")=%% >Mathletics</option>
                    <option value="mathseeds" %%=IIF(not empty(@mathseeds), "Selected", "")=%% >Mathseeds</option>
                    <option value="readingeggs" %%=IIF(not empty(@readingeggs), "Selected", "")=%% >Reading Eggs</option>

                  </select>
                  <div id="product_interest_invalid" class="custom-invalid-label custom-hide text-right">Select a product interest</div>
                </div>
              </div>
            </div>
            %%[EndIf]%%




            <!------------- First Name ----------------->

            %%[If @FIRST_NAME Then]%%
            <div class="row" style="display: none;">
              <div class="col">
                <div class="form-group">
                  <input type="text"
                         class="form-control" 
                         id="first_name_input" 
                         name="first-name" 
                         placeholder="First Name"
                         value="%%=v(@_First_Name)=%%" 
                         autofocus
                         required>
                  <div class="required-marker">* </div>
                  <div id="first_name_invalid" class="custom-invalid-label custom-hide text-right">First name is required</div>
                </div>
              </div>
            </div>
            %%[EndIf]%%




            <!------------- Last Name ----------------->

            %%[If @LAST_NAME Then]%%            
            <div class="row" style="display: none;">
              <div class="col">
                <div class="form-group">

                  <input type="text"
                         class="form-control"
                         id="last_name_input" 
                         name="last-name" 
                         placeholder="Last Name"
                         value="%%=v(@_Last_Name)=%%" 
                         required>
                  <div class="required-marker">* </div>
                  <div id="last_name_invalid" class="custom-invalid-label custom-hide text-right">Last name is required</div>
                </div>
              </div>
            </div>
            %%[EndIf]%%




            <!------------- Email Addres----------------->

            %%[If @EMAIL_ADDRESS Then]%%            
            <div class="row" style="display: none;">
              <div class="col">
                <div class="form-group">

                  <input type="email"
                         class="form-control" 
                         id="email_address_input" 
                         name="email-address" 
                         placeholder="Email Address"
                         Value="%%=v(@_Email_Address)=%%" 
                         readonly
                         required>
                  <div class="required-marker">* </div>
                  <div id="email_address_invalid" class="custom-invalid-label custom-hide text-right">A valid email address is required</div>                  
                </div>
              </div>
            </div>
            %%[EndIf]%%




            <!------------- Phone Number ----------------->

            %%[If @PHONE_NUMBER Then]%%                        
            <div class="row">
              <div class="col">
                <div class="form-group">
                  <input type="tel" 
                         class="form-control"
                         id="phone_number_input" 
                         name="phone-number" 
                         placeholder="Mobile / Work Phone" 
                        >
                 
                  <div id="phone_number_invalid" class="custom-invalid-label custom-hide text-right">Please enter a phone number in E.164 format (digits, plus, hyphen, and space only). Cannot start with 0</div>                  
                </div>
               </div>
            </div>
            %%[EndIf]%%




            <!------------- Grade Level ----------------->

            %%[If @GRADE_LEVEL Then]%%            
            <div class="row">
              <div class="col">
                <div class="form-group">

                  <select class="form-control" 
                          id="grade_level_select" 
                          name="grade-level"
                          required
                          style="color:#495057c7; font-weight: 400;">
                    <option disabled selected>Select Grade Level</option>
                    <option value="K/R">K/R</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="I do not teach specific grades">I do not teach specific grades</option>
                  </select>
                  <div id="grade_level_invalid" class="custom-invalid-label custom-hide text-right">Grade level is required</div>                  
                </div>
              </div>
            </div>
            %%[EndIf]%%




            <!------------- Job Title ----------------->

            %%[If @JOB_TITLE Then]%%            
            <div class="row" style="display: none;">
              <div class="col">
                <div class="form-group">
<input type="hidden" name="job_title_select" value="%%=v(@_Job_Title )=%%">
                  <div class="required-marker">* </div>
                  <div id="job_title_invalid" class="custom-invalid-label custom-hide text-right">Job title is required</div>                  
                </div>
              </div>
            </div>
            %%[EndIf]%%




            <!------------- Country ----------------->

            %%[If @COUNTRY_NAME Then]%%            
            <div class="row" style="display: none;">
              <div class="col">
                <div class="form-group">

                  <select class="form-control" 
                          id="country_name_select" 
                          name="country-name"
                          onchange= handleChangeCountryName(event) 
                          required
                          style="color:#495057c7; font-weight: 400;">                
                    <option value="" selected disabled>Select Country</option>
                    %%[

                        /* Populate Country Options
                        ******************************/

                        Set @Countries_Main = LookupOrderedRows("Country_DE", 0, "IsMainCountry desc, CountryName asc", "Active", "True", "IsMainCountry", "True")
                        Set @SelectedCountry = @_Country_Name
                        For @i = 1 to RowCount(@Countries_Main) Do
                            Set @Country_Name = field(row(@Countries_Main, @i),"CountryName")
                            Set @Country_Code = field(row(@Countries_Main, @i),"CountryCode")
                            Set @Selected = IIf(@Country_Name == @SelectedCountry, 'selected', '')
                            OutputLine(Concat('<option value="', @Country_Name, '" data-countrycode="', @Country_Code, '" ', @Selected, '>', @Country_Name, '</option>'))
                        Next @i

                        OutputLine(Concat('<option disabled>------------------------------------------------------</option>'))

                        Set @Countries_All = LookupOrderedRows("Country_DE", 0, "CountryName asc", "Active", "True")
                        For @i = 1 to RowCount(@Countries_All) Do
                            Set @Country_Name = field(row(@Countries_All, @i),"CountryName")
                            Set @Country_Code = field(row(@Countries_All, @i),"CountryCode")
                            Set @Selected = IIf(@Country_Name == @SelectedCountry, 'selected', '')
                            OutputLine(Concat('<option value="', @Country_Name, '" data-countrycode="', @Country_Code, '" ', @Selected, '>', @Country_Name, '</option>'))
                        NEXT @i
                    ]%%

                  </select>
                  <div class="required-marker">* </div>
                  <div id="country_invalid" class="custom-invalid-label custom-hide text-right">Country is required</div>       
                </div>
              </div>
            </div>
            %%[EndIf]%%




            <!------------- State ----------------->

            %%[If @STATE_NAME Then]%%            
            <div class="row">
              <div class="col">
                <div class="form-group" id="state_name_form_group">

                  <select class="form-control" 
                          id="state_name_select" 
                          name="state-name"
                          required
                          style="color:#495057c7; font-weight: 400;">
                    <option disabled selected>Select State <small>&nbsp;(Please select a country first.)</small></option>
                  </select>
                  <div class="required-marker">* </div>
                  <div id="state_invalid" class="custom-invalid-label custom-hide text-right">State is required</div>                     
                </div>
              </div>
            </div>
            %%[EndIf]%%


            <!------------- Postal Code ----------------->

            %%[If @POSTAL_CODE Then]%%                        
            <div class="row">
              <div class="col">
                <div class="form-group">

                  <input class="form-control"
                         type="text"  
                         id="postal_code_input" 
                         name="postal-code" 
                         placeholder="Postcode / Zipcode"
                         title="Postcode/Zipcode is 4 digits with no spaces"
                         required>
                  <div class="required-marker">* </div>
                  <div id="postcode_invalid" class="custom-invalid-label custom-hide text-right">Postcode is required</div>  
                </div>
              </div>
            </div>
            %%[EndIf]%%




            <!------------- School Name ----------------->

            %%[If @SCHOOL_NAME Then]%%                        
            <div class="row">
              <div class="col">
                <div class="form-group">

                  <input type="text" 
                         class="form-control"
                         id="school_name_input"  
                         name="school-name"
                         placeholder="School Name" 
                         required>
                  <div class="required-marker">* </div>
                  <div id="school_name_invalid" class="custom-invalid-label custom-hide text-right">School name is required</div>                    
                </div>
              </div>
            </div>
            %%[EndIf]%%



            <!------------- No Of Licences  ----------------->

            %%[
            If indexOf(@fields, "NO_OF_LICENCES") > 0 OR @form == 'quote' Then
            ]%%                        
            <div class="row">
              <div class="col">
                <div class="form-group">

                  <input type="number" 
                         class="form-control"
                         id="no_of_licences_input" 
                         name="no-of-licences" 
                         placeholder="Number of Student Licenses"
                         required
                         min="20" max="1000">
                  <div id="no_of_licences_invalid" class="custom-invalid-label custom-hide text-right">Number of student licences required</div>                   
                </div>
              </div>
            </div>
            %%[EndIf]%%



            <!------------- Terms & Conditions ----------------->

            %%[If @TERMS_AND_CONDITIONS Then ]%%                        
            <div class="row mt-0">
              <div class="col">
                <div class="form-group">
%%[IF @_Terms_And_Conditions == True THEN]%%
                  <input 
                           type="checkbox" 
                           id="terms_and_conditions_input" 
                           name="terms-and-conditions"
                           value="true"
                           checked 
                           disabled 
                           tabindex="-1" />%%[Else]%%
                  <input 
                           type="checkbox" 
                           id="terms_and_conditions_input" 
                           name="terms-and-conditions"
                           value="true" 
                           disabled 
                           tabindex="-1" />%%[ENDIF]%%
  
                  <label for="terms_and_conditions_input" class="custom-field-terms form-check-label" >
                    I agree to the 3P Learning <a target="_parent" href="https://www.3plearning.com/terms/" style="text-decoration: underline;">terms and
                conditions</a>.</label>
                  
                  <div id="terms_and_conditions_invalid" class="custom-invalid-label custom-hide text-right">Please agree to the <a target="_parent" href="https://www.3plearning.com/terms/" style="text-decoration: underline;">terms and
                conditions</a>.</div>

                </div>
              </div>
            </div>
            %%[EndIf]%%



            <!------------- Subscriber Opt In ----------------->

            %%[If @SUBSCRIBER_OPT_IN Then]%%                        
            <div class="row mt-0">
              <div class="col">
                <div class="form-group">
                  %%[IF @_Subscriber_Opt_In == True THEN]%%
                    <input type="checkbox"
                           id="subscriber_opt_in_input" 
                           name="subscriber-opt-in"
                           value="true"
                           checked 
                           disabled                           
                           tabindex="-1" />
%%[Else]%%
                    <input type="checkbox"
                           id="subscriber_opt_in_input" 
                           name="subscriber-opt-in"
                           value="true" 
                           disabled                           
                           tabindex="-1" />
%%[ENDIF]%%

                  <label for="subscriber_opt_in_input" class="custom-field-terms form-check-label" style="display: inline;">
                    YES! Sign me up for monthly newsletters, educational content, resources and occasional promotional material.
                  </label>
                  <!-- <div id="subscriber_opt_in_invalid" class="custom-invalid-label custom-hide text-right">...</div> -->   
                </div>
              </div>
            </div>
            %%[EndIf]%%



            <!------------- Submit Button ----------------->

            %%[If @SUBMIT_BUTTON Then]%%                        
            <div class="row mt-4">
              <div class="col">
                <div class="form-group">
                  <button class="custom_submit_button"
                          type="submit"
                          name="myButton"
                          id="submit_button"
                          value="Submit"
                          >
                    Get Started Now
                  </button>
                </div>
              </div>
            </div>
            %%[EndIf]%%



          </div>
        </div>
      </div>
      <!-- //wrapper -->
    </form>



    <!-- ===========================  JAVASCRIPT  =========================== -->


    %%=Concat('<','script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>')=%%
    %%=Concat('<','script src="https://cdnjs.cloudflare.com/ajax/libs/libphonenumber-js/1.9.19/libphonenumber-js.min.js"></script>')=%%
    %%=Concat('<','script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>')=%%
    %%=Concat('<','script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>')=%%
    %%=Concat('<','script src="https://cdn.jsdelivr.net/npm/axios@0.24.0/dist/axios.min.js"></script>')=%%
    %%=Concat('<','script src="https://my.mathletics.com/MXformFieldFunctions"></script>')=%%






    <!-- Custom Javascript -->

    %%=Concat('<','script>')=%%
    
    /**************************************************
    ----- Parse Cookie Data to hidden form fields -----
    ***************************************************/
    
// Parse the Cookie
  var cname = "setURLParamsCookie"
function getCookie(cname) {
 var name = cname + "=";
 var decodedCookie = decodeURIComponent(document.cookie);
 var ca = decodedCookie.split(';');
 for(var i = 0; i <ca.length; i++) {
  var c = ca[i];
  while (c.charAt(0) == ' ') {
   c = c.substring(1);
  }
  if (c.indexOf(name) == 0) {
   return c.substring(name.length, c.length);
  }
 }
 return "";
}
var referrer = getCookie("__gtm_referrer");
// Parse the URL inside Cookie
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");

    results = regex.exec(getCookie("setURLParamsCookie"));
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}
// Pass the values to hidden field 
var cookieCheck = document.cookie.indexOf('setURLParamsCookie')                               
if (cookieCheck > 0) {
document.querySelector("#utm-source").value = getParameterByName('utm_source');   
document.querySelector("#utm-medium").value = getParameterByName('utm_medium');   
document.querySelector("#utm-campaign").value = getParameterByName('utm_campaign');   
document.querySelector("#utm-content").value = getParameterByName('utm_content');
document.querySelector("#utm-term").value = getParameterByName('utm_term');
document.querySelector("#gclid").value = getParameterByName('gclid');
document.querySelector("#referrer").value = referrer;
  };

    %%=Concat('<','/script>')=%%
    
    %%=Concat('<','script>')=%%

    /****************************
    ----- On Submit -----
    *****************************/

  function checkForm(form) // Submit button clicked
  {
    //
    // check form input values
    //
    let x = document.getElementById("submit_button");
    setTimeout(function(){ x.innerHTML="Processing..." }, 2000);
    form.myButton.innerHTML = "Please wait...";
    form.myButton.disabled = true;
    form.myButton.value = "Please wait...";
    return true;
  }

   /****************************
    ----- On Country Change -----
    *****************************/


    //CONSTANTS
    let allStateNameData;

    //DOM ELEMENTS
    const thisDocument = $(document);
    const countryNameSelect = $('#country_name_select');
    const stateNameFormGroup = $('#state_name_form_group');
    const stateNameSelect = $('#state_name_select');


    //EVENTS
    // EVENTS
    thisDocument.ready(() => {
      getStateNameData().then(() => {
    // Initialize the page here or trigger any other actions.
    // This code will be executed after the state data has been fetched.
      });
    });
    countryNameSelect.on('change', handleChangeCountryName);


    //HANDLERS

    function getStateNameData() {
      return new Promise((resolve, reject) => {
        let allStatesURLPath = "/re_states";
        axios.get(allStatesURLPath)
          .then(response => {
            allStateNameData = response.data;
            console.log("State data loaded:", allStateNameData);
            countryNameSelect.trigger('change');
            resolve(); // Resolve the Promise when data is fetched
          })
          .catch(error => {
            reject(error); // Reject the Promise if there's an error
            console.error(error);
          });
      });
    }

    function handleChangeCountryName(e) {
    // Choose states
    let countryCode = e.target[e.target.selectedIndex].dataset.countrycode;
    console.log("Selected country code:", countryCode);
    let countryStateData = allStateNameData.filter((option) => option["Country Code"] == countryCode);

    // Reset options
    stateNameSelect.val('');
    stateNameSelect.find("option").remove();
    
    // Set the default message based on whether a country is selected or not
    let defaultMessage = countryCode ? `Select ${countryCode === "CA" ? 'Province' : 'State'}` : 'Please select a country first.';
    stateNameSelect.append(`<option disabled selected>${defaultMessage}</option>`);

    // Populate options or hide select
    if (countryStateData.length > 0) {
      // States found
      stateNameFormGroup.show();
      stateNameSelect.attr("required", "true");
      countryStateData.forEach((state) => {
        stateNameSelect.append(`<option value="${state['State Code']}">${state['State Name']}</option>`);
      });
    } else {
      // No states found
      stateNameFormGroup.hide();
      stateNameSelect.removeAttr("required");
    }
  }


$("#phone_number_input").on('input', function () {
    var inputVal = $(this).val().trim();
    var e164Format = /^\+?[1-9]\d{1,14}$/; // E.164 regex pattern

    // Check if input value matches E.164 format
    if (!e164Format.test(inputVal)) {
        $("#phone_number_invalid").show(); // Show validation message if not matching
    } else {
        $("#phone_number_invalid").hide(); // Hide validation message if matching
    }

});
    
    
    %%=Concat('<','/script>')=%%




  </body>
</html>




