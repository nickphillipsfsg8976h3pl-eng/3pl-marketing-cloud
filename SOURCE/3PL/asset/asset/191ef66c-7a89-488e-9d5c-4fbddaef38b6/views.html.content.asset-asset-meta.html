%%[
SET @subscriberkey = _SubscriberKey
SET @JobID = jobID
SET @listid = listid
SET @batchid = _JobSubscriberBatchID


/* Is this a lead or a contact*/
 IF Substring(@subscriberkey,1,3) == '003' THEN
    SET @type = "Contact_Salesforce_8"
     SET @updatetype = "Contact"
    ELSEIF Substring(@subscriberkey,1,3) == '00Q' THEN
     SET @type = "Lead_Salesforce_8"
   SET @updatetype = "Lead"
 ELSE Redirect(CloudPagesURL(2572))
 ENDIF


/*kept receiving errors trying to LookUpRows for the objects so am looking up the CRM instead*/
SET @lookupsubscriber = RetrieveSalesforceObjects(@updatetype, "Email,HasOptedOutOfEmail,Marketing_Interest__c,Marketing_Product_Interest__c","Id", "=", @subscriberkey)
IF RowCount(@lookupsubscriber) == 1 THEN /* there should only be one row */
    SET @subscriberRow = Row(@lookupsubscriber, 1)
    SET @email = Field(@subscriberRow, "Email")
 SET @marketingproductinterest = Field(@subscriberRow, "Marketing_Product_Interest__c")
 SET @marketinginterest = Field(@subscriberRow, "Marketing_Interest__c")
 SET @unsuball = Field(@subscriberRow, "HasOptedOutOfEmail")
          
ELSE Redirect(CloudPagesURL(2572))
ENDIF

IF @unsuball == false THEN
 SET @unsuballresult = ''
ELSE 
 SET @unsuballresult = 'checked="yes"'
ENDIF

/*Check the Marketing Interest values in the field and populate the selections*/
SET @prodinfo = 'Product information'
IF IndexOf(@marketinginterest,@prodinfo) > 0 THEN
 SET @product = 'checked="yes"'
ELSE 
 SET @product = ''
ENDIF
          
SET @newsl = 'Newsletter'
IF IndexOf(@marketinginterest,@newsl) > 0 THEN
 SET @newsletter = 'checked="yes"'
ELSE 
 SET @newsletter = ''
ENDIF
          
SET @promos = 'Promotions'
IF IndexOf(@marketinginterest,@promos) > 0 THEN
 SET @featpromos = 'checked="yes"'
ELSE 
 SET @featpromos = ''
ENDIF
]%%

 <!DOCTYPE html>
 <html>
 <head>
 <!--Import Google Icon Font-->
 <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
 <!--Import materialize.css-->
 <link type="text/css" rel="stylesheet" href="https://cloud.my.3plearning.com/preferencescss"  media="screen,projection"/>
 
 <!--Let browser know website is optimized for mobile-->
 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <style>
@media only screen and (max-width:480px) {
/* MOBILE GLOBAL STYLES - DO NOT CHANGE */
body, .tb_properties{font-family: Arial !important; font-size: 16px !important; color: #808080 !important; line-height: 1 !important; padding: 0px !important; }.buttonstyles{font-family: Arial !important; font-size: 16px !important; color: #FFFFFF !important; padding: 0px !important; }h1{font-family: Arial !important; font-size: 22px !important; color: #202020 !important; line-height: 1 !important; }h2{font-family: Arial !important; font-size: 20px !important; color: #202020 !important; line-height: 1 !important; }h3{font-family: Arial !important; font-size: 18px !important; color: #202020 !important; line-height: 1 !important; }a:not(.buttonstyles){line-height: 1 !important; }.mobile-hidden{display: none !important; }.responsive-td {width: 100% !important; display: block !important; padding: 0 !important;}
/* END OF MOBILE GLOBAL STYLES - DO NOT CHANGE */
}
</style>
 </head>
 <script>
   function validate(event) {
    event.preventDefault();
    
 hideAllErrorMsg();
  var flagValidation = true;
 var emailPattern = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    var validationStuff = '<span for="emailAdress" class="error-label" style="display: inline;"></span><span class="tooltip-arrow-error-msg"></span>';
 
 if (!($('#EmailAddress').val())) {
  flagValidation = false;
  $('#EmailAddressErr').show().html('Please enter email address.' + validationStuff);
  $('#EmailAddress').css('border', '2px solid #ff0000');
 } else if (!emailPattern.test($('#EmailAddress').val())) {
  // email address is not valid
  flagValidation = false;
  $('#EmailAddressErr').show().html("Please enter a valid email address." + validationStuff);
  $('#EmailAddress').css('border', '2px solid #ff0000');
 } else {
   /*email address is valid - show the reconfirm email box */
  $('#EmailAddressErr').hide().html("");
  $('#EmailAddress').css('border', '2px solid #adadad');
 }
   }
  </script>
 <body class="">
 <nav class="" role="navigation">
   <div class="nav-wrapper container"><a id="logo-container" href="https://www.3plearning.com/" alt="3PLearning Website Link" class="brand-logo"><img src="https://image.my.3plearning.com/lib/fe9413737461017874/m/1/055af50d-722b-450e-a34d-88cb191a2384.png"/></a> </div>
 </nav>
 <body>
 <div class="container">
   <form action="https://cloud.my.3plearning.com/processing_preferences" method="POST" id="datacapture">
     <div class="row">
       <div class="col xl6 l12 m12 s12">
         <div class="section">
           <h1 class="header">Update your email preferences</h1>
           <p class="">Choose what communications you’d like to receive from 3P Learning. We’re always trying to provide you with the most relevant information, ideas, tips and news – if you have any feedback, we’d love to hear it – reach out to support@3plearning.com with your thoughts! <br>
             <br>
             Here are the communications you’re currently receiving: </p>
           <div class="row">
             <div class="col l12 m12 s12">
               <div class="input-field">
                 <input value="%%=v(@email)=%%" placeholder="%%=v(@email)=%%" id="EmailAddress" type="text" class="validate" disabled>
                 <label id="EmailAddressErr" class="tooltip-error-msg bottom error errMsg"><span class="error-label" style="display: inline;"></span> <span class="tooltip-arrow-error-msg"></span></label>
                 <label for="EmailAddress">Email Address</label>
               </div>
             </div>
           </div>
         </div>
         <!-- Hidden -->
         <div>
           <input type="hidden" id="subscriberkey" name="subscriberkey" value="%%=v(@subscriberkey)=%%" />
         </div>
         <div>
           <input type="hidden" id="typeofcontact" name="typeofcontact" value="%%=v(@updatetype)=%%" />
         </div>
         <div class="section">
           <p class="">Here are the email types you currently receive:</p>
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l10 m10 s10">
               <h3 class="">Product Updates</h3>
               <p>What’s new with 3P Learning products you’re following, like new features, games and activities, as well as bug-fixes, troubleshooting and upcoming upgrades. </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="product" name="product" value="1" %%=v(@product)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
           <div class="row">
             <div class="col l10 m10 s10"> </div>
             <div class="col l2 m2 s2"> </div>
           </div>
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l10 m10 s10">
               <h3 class="">Newsletter</h3>
               <p>Get regular updates from the Team at 3P Learning, with insights, blogs, resources, and what’s happening in the wonderful world of Edtech!</p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="newsletter" name="newsletter" value="1" %%=v(@newsletter)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
           <div class="row">
             <div class="col l10 m10 s10"> </div>
             <div class="col l2 m2 s2"> </div>
           </div>
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l10 m10 s10">
               <h3 class="">Features and Promotions</h3>
               <p>See how the range of 3P Learning products can complement your students or kids’ education, from maths, to spelling, to STEM and literacy development. </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="features" name="features" value="1" %%=v(@featpromos)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
           <div class="row">
             <div class="col l10 m10 s10"> </div>
             <div class="col l2 m2 s2"> </div>
           </div>
         </div>
         <div class="row">
           <div class="col l10 m10 s10"> </div>
           <div class="col l2 m2 s2"> </div>
         </div>
         <div class="section">
           <p class="">Here are the products you are receiving information about:</p>
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l3 m2 hide-on-small-and-down"> <img src="https://image.my.3plearning.com/lib/fe9413737461017874/m/1/fd97c9c3-c2bb-4c06-9f5a-131e1634d8d1.png" alt="Mathletics Logo" class="responsive-img circle grey lighten-3"> </div>
             <div class="col l7 m8 s10"> %%[/* Check the Marketing Product Interest values in the field and populate the selections*/
               SET @rowinterests = BuildRowsetFromString(@marketingproductinterest,";")
               for @i = 1 to Rowcount(@rowinterests) do
               SET @row = Row(@rowinterests,@i)
               SET @value = Field(@row,1)
               IF @value == 'Mathletics' THEN
               SET @mathletics = 'checked="yes"'
               ELSEIF @value == 'Readiwriter Spelling' THEN
               SET @readiwriter = 'checked="yes"'
               ELSEIF @value == 'Spellodrome' THEN
               SET @spellodrome = 'checked="yes"'
               ELSEIF @value == 'ReadingEggs' THEN
               SET @readingeggs = 'checked="yes"'                                      
               ELSEIF @value == 'Mathseeds' THEN
               SET @mathseeds = 'checked="yes"'
               ELSEIF @value == 'WordFlyers' THEN
               SET @WordFlyers = 'checked="yes"'                                  
               ELSEIF @value == 'Readiwriter-Phonics' THEN
               SET @readiwriterphonics = 'checked="yes"'
               ELSEIF @value == 'MathleticsPlay' THEN
               SET @MathleticsPlay = 'checked="yes"'
               ELSEIF @value == 'WordFlyers' THEN
               SET @WordFlyers = 'checked="yes"'
               ELSEIF @value == 'STEMscopes' THEN
               SET @stem = 'checked="yes"'
               ELSE 
               SET @result = 'No Interests'
               ENDIF
               next @i
               endif
               ]%%
               <h3 class="">Mathletics</h3>
               <p>Our world-famous mathematics program created by specialist educators to support in-school or at-home learning. Used by over 200,000 teachers and loved by more than 3 million learners around the world. </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="mathletics" name="mathletics" value="1" %%=v(@mathletics)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>

           %%[IF @value == 'Readiwriter Spelling' THEN ]%%
           <div class="row valign-wrapper card-panel hoverable">
            <div class="col l3 m2 hide-on-small-and-down"> <img src="https://image.my.3plearning.com/lib/fe9413737461017874/m/2/4de4ec01-8e98-482f-8eba-5ae48b125ced.png" alt="Readiwriter Spelling Logo" class="responsive-img circle grey lighten-3"> </div>
            <div class="col l7 m8 s10">
              <h3 class="">Readiwriter Spelling</h3>
              <p>Our renowned spelling program that helps to develop a deeper and more comprehensive understanding of spelling and vocabulary.
              </p>
            </div>
            <div class="col l2 m2 s3"> 
              <!-- Switch -->
              <div class="switch">
                <label>
                  <input type="checkbox" id="readiwriter-spelling" name="readiwriter-spelling" value="1" %%=v(@readiwriter)=%%>
                  <span class="lever"></span> </label>
              </div>
            </div>
          </div>   
          %%[ELSE]%%        
        %%[ENDIF]%%
              %%[IF @value == 'Spellodrome' THEN ]%%
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l3 m2 hide-on-small-and-down"> <img src="https://image.my.3plearning.com/lib/fe9413737461017874/m/1/68003506-d7aa-423d-9051-7292668c6ab6.png" alt="Spellodrome Logo" class="responsive-img circle grey lighten-3"> </div>
             <div class="col l7 m8 s10">
               <h3 class="">Spellodrome</h3>
               <p>The spelling program focusing on critical spelling awareness and independent writing development. </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="spellodrome" name="spellodrome" value="1" %%=v(@spellodrome)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
                %%[ELSE]%%
                %%[ENDIF]%%
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l3 m2 hide-on-small-and-down"> <img src="https://image.my.3plearning.com/lib/fe9413737461017874/m/1/96651f9c-b1d1-4a21-b40e-1fd0c9f38db9.png" alt="Reading Eggs Logo" class="responsive-img circle grey lighten-3"> </div>
             <div class="col l7 m8 s10">
               <h3 class="">Reading Eggs</h3>
               <p>The multi-award-winning reading program for children aged 2-13. </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="readingeggs" name="readingeggs" value="1" %%=v(@readingeggs)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
           
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l3 m2 hide-on-small-and-down"> <img src="https://image.my.3plearning.com/lib/fe9413737461017874/m/1/8a685bfd-ed3a-4d1e-8db4-805a8125fd95.png" alt="Mathseeds Logo" class="responsive-img circle grey lighten-3"> </div>
             <div class="col l7 m8 s10">
               <h3 class="">Mathseeds</h3>
               <p>The comprehensive online mathematics program for children aged 3-9. </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="mathseeds" name="mathseeds" value="1" %%=v(@mathseeds)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
              %%[IF @value == 'STEMscopes' THEN ]%%
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l3 m2 hide-on-small-and-down"> <img src="https://image.my.3plearning.com/lib/fe9413737461017874/m/1/6591183b-329d-469b-ae90-3efcee80a25d.png" alt="Stemscopes Logo" class="responsive-img circle grey lighten-3"> </div>
             <div class="col l7 m8 s10">
               <h3 class="">Stemscopes</h3>
               <p>The world’s most current, continuously updated digital science curriculum </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="stemscopes" name="stemscopes" value="1" %%=v(@stem)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
              %%[ELSE]%%
              %%[ENDIF]%%
                %%[IF @value == 'WordFlyers' THEN ]%%
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l3 m2 hide-on-small-and-down"> <img src="http://image.my.3plearning.com/lib/fe9413737461017874/m/1/35168f26-dc77-41ea-8298-a2f792376f70.png" alt="Wordflyers Logo" class="responsive-img circle grey lighten-3"> </div>
             <div class="col l7 m8 s10">
               <h3 class="">WordFlyers</h3>
               <p> WordFlyers is a literacy skill-building program for Years 7-10, supporting students with their grammar, reading, comprehension, punctuation vocabulary and writing. </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="wordflyers" name="wordflyers" value="1" %%=v(@WordFlyers)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
                %%[ELSE]%%
                %%[ENDIF]%%
           <div class="row valign-wrapper card-panel hoverable">
             <div class="col l10 m10 s10">
               <h3 class="">Unsubscribe from all marketing emails</h3>
               <p>Click here to unsubscribe from our news, articles, ideas, inspirations, and promotional offers from 3P Learning. </p>
             </div>
             <div class="col l2 m2 s3"> 
               <!-- Switch -->
               <div class="switch">
                 <label>
                   <input type="checkbox" id="unsubfromall" name="unsubfromall" value="1" %%=v(@unsuballresult)=%%>
                   <span class="lever"></span> </label>
               </div>
             </div>
           </div>
         </div>
         <input type="hidden" id="subkey" name="subkey" value="%%=v(@subscriberkey)=%%">
         <input type="hidden" id="type" name="type" value="%%=v(@updatetype)=%%">
         <input type="hidden" id="JobID" name="JobID" value="%%=v(@JobID)=%%">
         <input type="hidden" id="listid" name="listid" value="%%=v(@listid)=%%">
         <input type="hidden" id="batchid" name="batchid" value="%%=v(@batchid)=%%">
         <input type="hidden" id="email" name="email" value="%%=v(@email)=%%">
         <div class="row section">
           <button class="btn waves-effect waves-light" type="submit" name="action">Save Preferences</button>
         </div>
         <br />
       </div>
       <div class="col l6"> </div>
     </div>
     <!--END LEFT ROW-->
   </form>
   <!--END FORM--> 
 </div>
 <!--END CONTAINER-->
 <footer class="page-footer">
   <div class="footer-copyright">
     <div class="container">
       <div class="row">
         <div class="col l6 m12 s12 left-align copyright-left">
           <p class="">Copyright %%=Format(Now(), "yyyy")=%%. <a href="https://www.3plearning.com/">3P Learning</a> - Transforming lives through a love of learning.</p>
         </div>
         <div class="col l6 m12 s12 right-align copyright-right">
           <p class="grey-text darken-3"> <a class="" href="http://www.3plearning.com/hello/">About Us</a>&nbsp;&nbsp;&#124;&nbsp; <a class="" href="http://www.3plearning.com/careers/">Careers</a>&nbsp;&nbsp;&#124;&nbsp; <a class="" href="http://www.3plearning.com/contact/">Contact Us</a>&nbsp;&nbsp;&#124;&nbsp; <a class="" href="http://www.3plearning.com/privacy/">Privacy Policy</a>&nbsp;&nbsp;&#124;&nbsp; <a class="" href="http://www.3plearning.com/terms/">Terms &amp; Conditions</a> </p>
         </div>
       </div>
     </div>
     <!--END CONTAINER--> 
   </div>
   <!--END FOOTER--> 
 </footer>
 </body>
 
 <!--JavaScript at end of body for optimized loading-->
 <script type="text/javascript" src="https://cloud.my.3plearning.com/preferences_js"></script>
 </body>
 </html>
 